<!DOCTYPE html>
<meta charset="utf-8">
<title>Interactive Viz</title>
<style>
 
.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}
 
.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}
 
.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}
 
.link:hover {
  stroke-opacity: .5;
}
 
</style>
<svg width="960" height="500" class='chart'></svg>
<body>
 
<p id="chart">
 
<script src="http://d3js.org/d3.v3.js"></script>

<script>

var svg = d3.select('svg'),
	margin = {top:30, right: 30, bottom: 30, left: 30},
	width = +svg.attr('width') - margin.left - margin.right,
	height = +svg.attr('height') -margin.top - margin.bottom;
	
var svg2 = d3.select('svg'),
	margin = {top:30, right: 30, bottom: 30, left: 30},
	width = +svg.attr('width') - margin.left - margin.right,
	height = +svg.attr('height') -margin.top - margin.bottom;

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var g2 = svg2.append("g2")
    .attr("transform", "translate(" + width/2 + "," + margin.top + ")");

var data = [{product:'Product A',freq:{Q1:576, Q2:1176, Q3:1009, Q4:494}},
{product:'Product B',freq:{Q1:959, Q2:1653, Q3:1999, Q4:697}},
{product:'Product C',freq:{Q1:3210, Q2:4220, Q3:1648, Q4:919}},
{product:'Product D',freq:{Q1:589, Q2:2043, Q3:1153, Q4:911}},
{product:'Product E',freq:{Q1:2599, Q2:1333, Q3:818, Q4:1713}},
{product:'Product F',freq:{Q1:431, Q2:324, Q3:715, Q4:421}},
{product:'Product G',freq:{Q1:1457, Q2:2557, Q3:2245, Q4:762}},
{product:'Product H',freq:{Q1:2573, Q2:3357, Q3:1598, Q4:1287}}];

data.forEach(function (d) {
	d.total = d.freq.Q1 + d.freq.Q2 + d.freq.Q3 +d.freq.Q4
});
var width = 420,
    barHeight = 20;

// var nested = d3.nest()
// .key(function(d) {return d.product})
// .entries(data);

debugger
	
var x = d3.scale.linear()
    .domain([0, 12000])
    .range([0, width]);
console.log(x(data[0].total))
var chart = d3.select(".chart")
    .attr("width", width)
    .attr("height", barHeight * data.length);

var bar = chart.selectAll("g")
    .data(data)
  .enter().append("g")
    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

bar.append("rect")
    .attr("width", function(d) { return x(d.total); })
    .attr("height", barHeight - 1)
	.on('mouseover', interact)
	.on('mouseout', all)
	
function all(){
		d3.select(this)
		.attr('fill','black')
	 }

function interact(){
	d3.select(this)
	.attr('fill','red')
	var chart = d3.select("body")
	var prod = this.__data__.product
	var bar = chart.selectAll("g2");
	console.log(data)
	
		bar.data(data[0].freq)
	  .enter().append("g2")
		.attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

	bar.append("rect")
		.attr("width", function(d,i) { return 200; })
		.attr("height", barHeight - 1)
		// .on('mouseover', interact)
		// .on('mouseout', all)
}

bar.append("text")
    .attr("x", function(d) { return x(d.total) + 3; })
    .attr("y", barHeight / 2)
    .attr("dy", ".35em")
    .text(function(d) { return d.total; });
</script>
 
</body>
</html>